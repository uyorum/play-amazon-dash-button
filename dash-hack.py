from scapy.all import DHCP, sniff
import urllib2

evian = 'XX:XX:XX:XX:XX:XX'


def execute(pkt):
    if pkt[DHCP].options[0] == ('message-type', 3):       # DHCP Request
        if pkt.src == evian:
            data = '{"format":"raw","freq":38,"data":[8755,8755,1037,3228,1037,3228,1037,3228,1037,3228,1037,1037,1037,1037,1037,3228,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,3228,1037,3228,1037,1037,1037,3228,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,3228,1037,3228,1037,3228,1037,3228,1037,3228,1037,3228,1037,3228,1037,3228,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,3228,1037,3228,1037,1037,1037,1037,1037,3228,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,3228,1037,3228,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,3228,1037,1037,1037,1037,1037,3228,1037,1037,1037,1037,1037,3228,1037,1037,1037,10762,8755,8755,1037,3228,1037,3228,1037,3228,1037,3228,1037,1037,1037,1037,1037,3228,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,3228,1037,3228,1037,1037,1037,3228,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,3228,1037,3228,1037,3228,1037,3228,1037,3228,1037,3228,1037,3228,1037,3228,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,3228,1037,3228,1037,1037,1037,1037,1037,3228,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,3228,1037,3228,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,1037,3228,1037,1037,1037,1037,1037,3228,1037,1037,1037,1037,1037,3228,1037,1037,1037]}'
#            data = urllib.urlencode(data)
            header = {
                "X-Requested-With": "python",
                }
            url = "http://10.0.0.111/messages"
            req = urllib2.Request(url, data, header)
            res = urllib2.urlopen(req)
            print res.info().dict

print sniff(prn=execute,
            filter="udp and src host 0.0.0.0 and dst port 67",
            store=0,
            count=0)
